/*
----------------------------------------------------------------------------------------
    GeneLab Data Processing Proteomics Workflow Nextflow config file
----------------------------------------------------------------------------------------
    Default config options for all compute environments
----------------------------------------------------------------------------------------
*/

// Plugins
plugins {
  id 'nf-schema@2.6.1'
}

// Global default params, used in configs
params {
    dp_tools_plugin             = null      // Path to dp_tools plugin
    api_url                     = "https://visualization.osdr.nasa.gov/biodata/api/v2/dataset/*/"
    assay_suffix                = '_GLProteomics' // Suffix to append to output filenames

    
    // Input options
    accession                   = null // Accession number (OSD-# or GLDS-#)
    runsheet                    = null // For OSDR datasets, runsheet will be generated based on the ISA.zip associated with the dataset
    isa_archive                 = null // If a runsheet is not supplied, ISA.zip will be pulled from OSDR unless this is supplied    
    manifest                    = null // FragPipe manifest file. If not provided, will be generated from runsheet
    fragpipe_tools              = "${projectDir}/conf/tools"
    fragpipe_workflow           = null // Preset workflow name: "LFQ-MBR", "TMT10", "TMT16", or "TMT16-phospho". Used to select workflow file if fragpipe_workflow_config is not provided. Should be set even when using fragpipe_workflow_config for proper workflow-specific functionality (e.g., MSstats runs only for LFQ-MBR).
    fragpipe_workflow_config    = null // FragPipe workflow config file path. If provided, takes precedence over fragpipe_workflow parameter for workflow file selection. Note: fragpipe_workflow should still be set to enable workflow-specific features.

    // References
    reference_store_path        = './References' // Dictates where the reference fasta, gtf will be stored
    derived_store_path          = './DerivedReferences' // Dictates where the derived reference files (locally built indexes) will be stored

    // Database options - use EITHER uniprot_id OR reference_proteome, not both
    uniprot_id                  = null // UniProt proteome ID (e.g., UP000059680, UP001231189). If provided, will download proteome FASTA from UniProt using Philosopher. Cannot be used with reference_proteome.
    reference_proteome          = null // Pre-formed FASTA file path. If provided, will use this file via --custom. Cannot be used with uniprot_id.
    
    // Philosopher database options (used for both --id and --custom modes)
    philosopher_reviewed           = true  // Download only reviewed (Swiss-Prot) entries. Only valid with --id, ignored with --custom
    philosopher_isoforms           = true  // Include protein isoforms in database. Only valid with --id, ignored with --custom
    philosopher_contaminants       = true  // Add common contaminant proteins (human keratins, trypsin, etc.)
    philosopher_contaminants_prefix = false // Mark contaminant sequences with prefix tag. Requires philosopher_contaminants=true
    philosopher_decoy_prefix       = 'rev_' // Prefix for decoy sequences (reversed proteins)
    philosopher_nodecoys           = false  // Do not add decoy sequences to database
    philosopher_enzyme             = 'trypsin' // Enzyme for digestion: trypsin, lys_c, lys_n, glu_c, chymotrypsin
    philosopher_spike_in           = null  // Path to spike-in FASTA file to add to database (e.g., iRT peptides for retention time calibration)


    
    // QC
    multiqc_config              = "${projectDir}/conf/multiqc.config"

    //    // MSFragger search parameters
    //    search_type                            = 'closed' // Search type: 'closed', 'open', or 'nonspecific'
    //    msfragger_config_file                  = null // Complete MSFragger config file path. If provided, skips config generation and uses this file directly
    //    run_crystal_c                          = false // Run Crystal-C mass recalibration (only valid for open searches)
    //    crystal_c_config_file                  = null // Complete Crystal-C config file path. If provided, skips config generation and uses this file directly
    //    
    //    // Crystal-C parameter overrides (set to null to use template default, or override with custom value)
    //    crystal_c_precursor_charge             = null  // Precursor charge state range (e.g., "1 6")
    //    crystal_c_isotope_number               = null  // Number of theoretical isotope peaks (default: 3)
    //    crystal_c_precursor_mass               = null  // Precursor mass tolerance in ppm (default: 20.0)
    //    crystal_c_precursor_isolation_window   = null  // Precursor isolation window in Da (default: 0.7)
    //    crystal_c_correct_isotope_error        = null  // Correct isotope error (default: false)
    //    crystal_c_raw_file_location            = null  // Directory where raw data (mzML) files are located (optional, pepXML references mzML internally)
    //    crystal_c_raw_file_extension           = null  // File extension of raw data (default: mzML)
    //    
    //    // IonQuant quantification parameters (all have defaults, set to override)
    //    // IonQuant runs in its own biocontainer: quay.io/biocontainers/ionquant:1.11.9--py311hdfd78af_0
    //    // JAR path in container: /usr/local/share/ionquant-1.11.9-0/IonQuant.jar
    //    ionquant_perform_ms1quant             = 1     // Perform MS1 quantification. 0 = no, 1 = yes. Default: 1
    //    ionquant_perform_isoquant             = 0     // Perform isobaric labeling quantification. 0 = no, 1 = yes. Default: 0
    //    ionquant_isotol                       = 10.0  // MS2 tolerance in ppm. Default: 10
    //    ionquant_isolevel                     = 2     // Isobaric quantification level. 2 = MS2, 3 = MS3. Default: 2
    //    ionquant_isotype                      = 'TMT-10' // Isobaric quantification type. Choices: iTRAQ-4, iTRAQ-8, TMT-0, TMT-2, TMT-6, TMT-10, TMT-11, TMT-16, TMT-18, TMT-35, sCLIP-6, iBT-16, DiLeu-12, DiLeu-1, DeAla-13. Default: TMT-10
    //    ionquant_annotation                   = null  // Annotation file info for isobaric quantification. Format: <path to psm.tsv>=<path to annotation file>
    //    ionquant_site_reports                 = 1     // Generate site reports. 0 = no, 1 = yes. Default: 1
    //    ionquant_msstats                      = 1     // Generate MSstats input files. 0 = no, 1 = yes. Default: 1
    //    ionquant_mztol                        = 10.0  // MS1 tolerance in PPM. Default: 10.0
    //    ionquant_imtol                        = 0.05  // 1/K0 tolerance. Default: 0.05
    //    ionquant_rttol                        = 0.4   // Retention time tolerance. Unit: min. Default: 0.4
    //    ionquant_multidir                     = null  // Output directory for multi-experimental result. Optional
    //    ionquant_normalization                 = 1     // Normalize intensities across all runs. Default: 1
    //    ionquant_minisotopes                  = 2     // Minimum isotopes required in feature extraction. Default: 2
    //    ionquant_minscans                     = 3     // Minimum MS1 scans required in feature extraction. Default: 3
    //    ionquant_minions                      = 1     // Minimum ions required in quantifying proteins (MaxLFQ only). Default: 1
    //    ionquant_excludemods                  = null  // Excluded modifications. Format: <amino acid><mass>;...
    //    ionquant_maxlfq                       = 1     // Calculate MaxLFQ intensity. 0 = no, 1 = yes. Default: 1
    //    ionquant_ibaq                         = 0     // Calculate iBAQ intensity. 0 = no, 1 = yes. Default: 0
    //    ionquant_minexps                      = 1     // Minimum experiments in picking an ion for protein quantification. Default: 1
    //    ionquant_minfreq                      = 0.0   // Minimum required frequency of an ion being selected. Default: 0
    //    ionquant_tp                           = 0     // Number of ions used in quantifying each protein. 0 = all ions. Default: 0
    //    ionquant_mbr                          = 0     // Perform match-between-runs. Default: 0
    //    ionquant_mbrrttol                     = 1.0   // Retention time tolerance used in match-between-runs. Unit: min. Default: 1.0
    //    ionquant_mbrimtol                     = 0.05  // 1/K0 tolerance used in match-between-runs. Default: 0.05
    //    ionquant_mbrtoprun                    = 10    // Maximum number of donor runs for each acceptor run. Default: 10
    //    ionquant_mbrmincorr                   = 0.0   // Minimum correlation coefficient between donor and acceptor run. Default: 0
    //    ionquant_ionmobility                  = 0     // Data has ion mobility information. 0 = no, 1 = yes. Default: 0
    //    ionquant_ionfdr                       = 0.01  // Transferred ion false discovery rate threshold. Default: 0.01
    //    ionquant_peptidefdr                   = 1.0   // Transferred peptide false discovery rate threshold. Default: 1
    //    ionquant_proteinfdr                   = 1.0   // Transferred protein false discovery rate threshold. Default: 1
    //    ionquant_light                        = null  // Light labelling mass. Format: <amino acids><mass>;<amino acids><mass>;...
    //    ionquant_medium                       = null  // Medium labelling mass. Format: <amino acids><mass>;<amino acids><mass>;...
    //    ionquant_heavy                        = null  // Heavy labelling mass. Format: <amino acids><mass>;<amino acids><mass>;...
    //    ionquant_formula                      = null  // Formula of modifications for isotope-labeling. Format: <chemical composition>;...
    //    ionquant_requantify                   = 1     // Re-quantify unidentified feature based on identified feature. Default: 1
    //    ionquant_writeindex                   = 0     // Write indexed file on disk. 0 = no, 1 = yes. Default: 0
    //    ionquant_locprob                      = 0.0   // Localization probability threshold. Default: 0
    //    ionquant_uniqueness                   = 0     // Peptide-protein uniqueness. 0 = unique+razor, 1 = unique only, 2 = all. Default: 0
    //    ionquant_intensitymode                = 0     // Mode to calculate ion intensity. 0 = apex, 1 = area. Default: 0
    //    ionquant_modlist                      = null  // File listing modification masses for rounding error removal
    //    
    //    // MSFragger parameter overrides (set to null to use template default, or override with custom value)
    //    // Template values shown as: closed / open / nonspecific
    //    
    //    // Precursor mass tolerance
    //    msfragger_precursor_mass_lower         = null  // closed=-20, open=-150, nonspecific=-20
    //    msfragger_precursor_mass_upper         = null  // closed=20, open=500, nonspecific=20
    //    msfragger_precursor_mass_units        = null  // closed=1 (ppm), open=0 (Da), nonspecific=1 (ppm)
    //    msfragger_precursor_true_tolerance     = null  // closed=20, open=20, nonspecific=15
    //    msfragger_precursor_true_units        = null  // closed=1 (ppm), open=1 (ppm), nonspecific=1 (ppm)
    //    msfragger_precursor_mass_mode         = null  // closed=selected, open=corrected, nonspecific=selected
    //    
    //    // Fragment mass tolerance
    //    msfragger_fragment_mass_tolerance      = null  // closed=20, open=20, nonspecific=20
    //    msfragger_fragment_mass_units         = null  // closed=1 (ppm), open=1 (ppm), nonspecific=1 (ppm)
    //    
    //    // Mass calibration and processing
    //    msfragger_calibrate_mass              = null  // closed=2, open=2, nonspecific=2
    //    msfragger_use_all_mods_in_first_search = null  // closed=0, open=0, nonspecific=0
    //    msfragger_decoy_prefix                = null  // closed=rev_, open=rev_, nonspecific=rev_
    //    
    //    // Isotope and mass offsets
    //    msfragger_deisotope                   = null  // closed=1, open=1, nonspecific=1
    //    msfragger_deneutralloss               = null  // closed=1, open=1, nonspecific=1
    //    msfragger_isotope_error               = null  // closed=0/1/2/3, open=0, nonspecific=0/1
    //    msfragger_mass_offsets                = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_mass_offsets_detailed      = null  // closed=, open=, nonspecific=
    //    msfragger_use_detailed_offsets       = null  // closed=0, open=0, nonspecific=0
    //    
    //    // Precursor peak removal
    //    msfragger_remove_precursor_peak       = null  // closed=1, open=1, nonspecific=1
    //    msfragger_remove_precursor_range      = null  // closed=-1.500000,1.500000, open=-1.500000,1.500000, nonspecific=-1.500000,1.500000
    //    
    //    // Spectrum processing
    //    msfragger_intensity_transform         = null  // closed=0, open=0, nonspecific=1
    //    msfragger_activation_types            = null  // closed=all, open=all, nonspecific=all
    //    msfragger_analyzer_types              = null  // closed=all, open=all, nonspecific=all
    //    msfragger_group_variable              = null  // closed=0, open=0, nonspecific=0
    //    msfragger_require_precursor           = null  // closed=1, open=1, nonspecific=1
    //    msfragger_reuse_dia_fragment_peaks    = null  // closed=0, open=0, nonspecific=0
    //    
    //    // Output options
    //    msfragger_write_calibrated_mzml       = null  // closed=0, open=0, nonspecific=0
    //    msfragger_write_uncalibrated_mzml     = null  // closed=1, open=1, nonspecific=1
    //    msfragger_write_mzbin_all             = null  // closed=0, open=0, nonspecific=0
    //    msfragger_mass_diff_to_variable_mod   = null  // closed=0, open=0, nonspecific=0
    //    
    //    // Delta mass localization
    //    msfragger_localize_delta_mass         = null  // closed=0, open=1, nonspecific=0
    //    msfragger_delta_mass_exclude_ranges   = null  // closed=(-1.5,3.5), open=(-1.5,3.5), nonspecific=(-1.5,3.5)
    //    msfragger_fragment_ion_series         = null  // closed=b,y, open=b,y, nonspecific=b,y
    //    msfragger_ion_series_definitions      = null  // closed=, open=, nonspecific=
    //    
    //    // Labile search mode
    //    msfragger_labile_search_mode          = null  // closed=off, open=off, nonspecific=off
    //    msfragger_restrict_deltamass_to       = null  // closed=all, open=all, nonspecific=all
    //    msfragger_diagnostic_intensity_filter = null  // closed=0, open=0, nonspecific=0
    //    msfragger_Y_type_masses               = null  // closed=, open=, nonspecific=
    //    msfragger_diagnostic_fragments        = null  // closed=, open=, nonspecific=
    //    msfragger_remainder_fragment_masses   = null  // closed=, open=, nonspecific=-18.01056/79.96633
    //    
    //    // Enzyme settings
    //    msfragger_search_enzyme_name_1        = null  // closed=stricttrypsin, open=stricttrypsin, nonspecific=nonspecific
    //    msfragger_search_enzyme_cut_1         = null  // closed=KR, open=KR, nonspecific=@
    //    msfragger_search_enzyme_nocut_1       = null  // closed=, open=, nonspecific=
    //    msfragger_search_enzyme_sense_1       = null  // closed=C, open=C, nonspecific=C
    //    msfragger_allowed_missed_cleavage_1   = null  // closed=2, open=2, nonspecific=2
    //    msfragger_search_enzyme_name_2        = null  // closed=null, open=null, nonspecific=null
    //    msfragger_search_enzyme_cut_2         = null  // closed=, open=, nonspecific=@
    //    msfragger_search_enzyme_nocut_2       = null  // closed=, open=, nonspecific=
    //    msfragger_search_enzyme_sense_2       = null  // closed=C, open=C, nonspecific=C
    //    msfragger_allowed_missed_cleavage_2   = null  // closed=2, open=2, nonspecific=2
    //    msfragger_num_enzyme_termini          = null  // closed=2 (fully-enzymatic), open=2 (fully-enzymatic), nonspecific=0 (non-enzymatic)
    //    msfragger_clip_nTerm_M                = null  // closed=1, open=1, nonspecific=1
    //    
    //    // Variable modifications (format: mass amino_acids max_per_peptide)
    //    msfragger_variable_mod_01             = null  // closed=15.9949 M 3, open=15.9949 M 3, nonspecific=15.9949 M 2
    //    msfragger_variable_mod_02             = null  // closed=42.0106 [^ 1, open=42.0106 [^ 1, nonspecific=42.0106 [^ 1
    //    msfragger_variable_mod_03             = null  // closed=79.96633 STY 3, open=79.96633 STY 3, nonspecific=79.96633 STY 3
    //    msfragger_variable_mod_04             = null  // closed=-17.0265 nQnC 1, open=-17.0265 nQnC 1, nonspecific=-17.0265 nQ 1
    //    msfragger_variable_mod_05             = null  // closed=-18.0106 nE 1, open=-18.0106 nE 1, nonspecific=-18.0106 nE 1
    //    msfragger_variable_mod_06             = null  // closed=4.025107 K 2, open=4.025107 K 2, nonspecific=119.0041 C 1
    //    msfragger_variable_mod_07             = null  // closed=6.020129 R 2, open=6.020129 R 2, nonspecific=0.98402 N 1
    //    msfragger_variable_mod_08             = null  // closed=8.014199 K 2, open=8.014199 K 2, nonspecific=8.014199 K 1
    //    msfragger_variable_mod_09             = null  // closed=10.008269 R 2, open=10.008269 R 2, nonspecific=10.008269 R 1
    //    msfragger_variable_mod_10             = null  // closed=0.0 site_10 1, open=0.0 site_10 1, nonspecific=0.0 site_10 1
    //    msfragger_variable_mod_11             = null  // closed=0.0 site_11 1, open=0.0 site_11 1, nonspecific=0.0 site_11 1
    //    msfragger_variable_mod_12             = null  // closed=0.0 site_12 1, open=0.0 site_12 1, nonspecific=0.0 site_12 1
    //    msfragger_variable_mod_13             = null  // closed=0.0 site_13 1, open=0.0 site_13 1, nonspecific=0.0 site_13 1
    //    msfragger_variable_mod_14             = null  // closed=0.0 site_14 1, open=0.0 site_14 1, nonspecific=0.0 site_14 1
    //    msfragger_variable_mod_15             = null  // closed=0.0 site_15 1, open=0.0 site_15 1, nonspecific=0.0 site_15 1
    //    msfragger_variable_mod_16             = null  // closed=0.0 site_16 1, open=0.0 site_16 1, nonspecific=0.0 site_16 1
    //    msfragger_allow_multiple_variable_mods_on_residue = null  // closed=0, open=0, nonspecific=0
    //    msfragger_max_variable_mods_per_peptide = null  // closed=3, open=3, nonspecific=3
    //    msfragger_max_variable_mods_combinations = null  // closed=5000, open=5000, nonspecific=5000
    //    
    //    // Output format
    //    msfragger_output_format               = null  // closed=pepXML_pin, open=pepXML_pin, nonspecific=pepXML_pin
    //    msfragger_output_report_topN          = null  // closed=1, open=1, nonspecific=1
    //    msfragger_output_max_expect           = null  // closed=50, open=50, nonspecific=50
    //    msfragger_report_alternative_proteins = null  // closed=1, open=1, nonspecific=1
    //    
    //    // Precursor charge
    //    msfragger_precursor_charge            = null  // closed=1 4, open=1 4, nonspecific=1 4
    //    msfragger_override_charge             = null  // closed=0, open=0, nonspecific=0
    //    
    //    // Digestion parameters
    //    msfragger_digest_min_length           = null  // closed=7, open=7, nonspecific=7
    //    msfragger_digest_max_length           = null  // closed=50, open=50, nonspecific=25
    //    msfragger_digest_mass_range           = null  // closed=500.0 5000.0, open=500.0 5000.0, nonspecific=200.0 5000.0
    //    msfragger_max_fragment_charge         = null  // closed=2, open=2, nonspecific=2
    //    
    //    // Zero-bin tracking
    //    msfragger_track_zero_topN             = null  // closed=0, open=0, nonspecific=0
    //    msfragger_zero_bin_accept_expect     = null  // closed=0, open=0, nonspecific=0
    //    msfragger_zero_bin_mult_expect        = null  // closed=1, open=1, nonspecific=1
    //    
    //    // Spectrum filtering
    //    msfragger_check_spectral_files        = null  // closed=1, open=1, nonspecific=1
    //    msfragger_minimum_peaks               = null  // closed=15, open=15, nonspecific=15
    //    msfragger_use_topN_peaks              = null  // closed=150, open=150, nonspecific=300
    //    msfragger_min_fragments_modelling     = null  // closed=2, open=2, nonspecific=2
    //    msfragger_min_matched_fragments       = null  // closed=4, open=4, nonspecific=5
    //    msfragger_min_sequence_matches        = null  // closed=2, open=2, nonspecific=2
    //    msfragger_minimum_ratio               = null  // closed=0.01, open=0.01, nonspecific=0.00
    //    msfragger_clear_mz_range              = null  // closed=0.0 0.0, open=0.0 0.0, nonspecific=0.0 0.0
    //    
    //    // Fixed modifications (add_* parameters)
    //    msfragger_add_Cterm_peptide           = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_Nterm_peptide           = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_Cterm_protein           = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_Nterm_protein           = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_G_glycine               = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_A_alanine               = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_S_serine                = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_P_proline               = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_V_valine                = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_T_threonine             = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_C_cysteine              = null  // closed=57.02146, open=57.02146, nonspecific=57.02146
    //    msfragger_add_L_leucine               = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_I_isoleucine            = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_N_asparagine            = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_D_aspartic_acid         = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_Q_glutamine             = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_K_lysine                = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_E_glutamic_acid         = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_M_methionine            = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_H_histidine             = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_F_phenylalanine         = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_R_arginine              = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_Y_tyrosine             = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_W_tryptophan           = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_B_user_amino_acid       = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_J_user_amino_acid       = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_O_user_amino_acid       = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_U_user_amino_acid       = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_X_user_amino_acid       = null  // closed=0.0, open=0.0, nonspecific=0.0
    //    msfragger_add_Z_user_amino_acid       = null  // closed=0.0, open=0.0, nonspecific=0.0
    
    // See conf/msfragger/*.params for complete parameter documentation

    // Boilerplate options
    output_dir                  = '.' // Used to set the location where the results directory will be created
    results_dir                 = null // Used to name the directory that will hold the main workflow outputs. Leave as null
    publish_dir_mode            = 'link' // Published outputs may be symlinks if using containerized environments
    email                       = null
    version                     = false

}
validation {
    help {
        enabled = true
    }
    lenientMode = true
}

// Profiles:
// The following profile definitions are used to set environments for the pipeline.
//  Configs can be used to set executor configs, container profiles, tag and process-specific resource allocations, retry strategies, etc.

// The default executor profile is slurm which is defined under the profile 'slurm'. There is no default container-based profile.
//  To run processes locally, you must set the profile to local with 'nextflow run main.nf ... --profile local'

// By default, the container profile is not set meaning that the local environment is used.
//  The container profile is set using 'nextflow run main.nf ... --profile <profile_name>' 

// Multiple profiles can be set in the nextflow run command, e.g. 'nextflow run main.nf ... --profile <executor_profile>,<container_profile>'

// See https://www.nextflow.io/docs/latest/config.html#config-profiles for more information


profiles {
    debug {
        dumpHashes              = true
        process.beforeScript    = 'echo $HOSTNAME'
        cleanup                 = false
    }
    docker {
        docker.enabled          = true
        conda.enabled           = true
        singularity.enabled     = false
        podman.enabled          = false
        shifter.enabled         = false
        charliecloud.enabled    = false
        apptainer.enabled       = false
        docker.runOptions       = '-u $(id -u):$(id -g)'
        includeConfig 'conf/by_docker_image.config'
    }
    singularity {
        singularity.enabled     = true
        singularity.autoMounts  = true
        conda.enabled           = false
        docker.enabled          = false
        podman.enabled          = false
        shifter.enabled         = false
        charliecloud.enabled    = false
        apptainer.enabled       = false
        // Address issue: https://github.com/nextflow-io/nextflow/issues/1210
        process {
          containerOptions = "--no-home"
          errorStrategy = { 
            task.exitStatus == 255 ? 'retry' : 'terminate' 
            }
        }
        includeConfig 'conf/by_docker_image.config'
    }
    gitpod {
        executor.name           = 'local'
        executor.cpus           = 4
        executor.memory         = 8.GB
    }
    slurm {
        process {
            executor = 'slurm' // run using slurm backend (unless a process specifies otherwise), Nextflow will generate the sbatch script and submit for you
            errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'finish' }
            maxRetries    = 1
            maxErrors     = '-1'
            cache = 'lenient'
        }
    }
    local {
        process {
            executor = 'local'
            errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'finish' }
            maxRetries    = 1
            maxErrors     = '-1'
        }
    }
}

// Process-specific resource allocations
process {
    withName: 'GENERATE_MANIFEST' {
        cpus = 1
        memory = 2.GB
    }
    
    withName: 'STAGE_INPUT' {
        cpus = 1
        memory = 2.GB
    }
    
    withName: 'RUNSHEET_TO_MANIFEST' {
        cpus = 1
        memory = 2.GB
    }    

    withName: 'WORKFLOW_CONFIG_TO_JSON' {
        cpus = 1
        memory = 2.GB
    }    
    withName: 'GET_PROTEOME' {
        cpus = 1
        memory = 2.GB
    }
    
    withName: 'UPDATE_WORKFLOW_CONFIG' {
        cpus = 1
        memory = 2.GB
    }
    
    withName: 'RAWBEANS_QC' {
        cpus = 1
        memory = 2.GB
    }
    
    withName: 'RAWBEANS_QC_ALL' {
        cpus = 1
        memory = 2.GB
    }
    
    withName: 'RAW_READS_PMULTIQC' {
        cpus = 1
        memory = 4.GB
    }
    
    withName: 'FRAGPIPE' {
        cpus = 16
        memory = 48.GB
        stageInMode = 'copy'
    }
}

// Set default registry for Docker and Singularity

// Adapted from : https://github.com/nf-core/rnaseq/blob/master/nextflow.config
def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.output_dir}/nextflow_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.output_dir}/nextflow_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.output_dir}/nextflow_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${params.output_dir}/nextflow_info/pipeline_dag_${trace_timestamp}.html"
}

manifest {
    name            = 'NASA GeneLab Data Processing Proteomics Pipeline'
    homePage        = 'https://github.com/nasa/GeneLab_Data_Processing/tree/master/Proteomics'
    description     = 'Nextflow workflow for Documents GL-DPPD-7101-G and GL-DPPD-7115.'
    mainScript      = 'main.nf'
    nextflowVersion = '!>=24.10.6'
    version         = '1.0.0'
}
